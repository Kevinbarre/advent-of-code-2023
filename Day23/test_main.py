from main import part1, part2, parse_trail, get_possible_steps, navigate_trail, get_all_paths, get_target_position

filename = "example.txt"


def test_part1():
    # Given
    with open(filename) as f:
        lines = f.read().splitlines()
    # When
    result = part1(lines)
    # Then
    assert result == 94


def test_part2():
    # Given
    with open(filename) as f:
        lines = f.read().splitlines()
    # When
    result = part2(lines)
    # Then
    assert result == 0


def test_parse_trail():
    # Given
    lines = ["#.#####################",
             "#.......#########...###",
             "#######.#########.#.###",
             "###.....#.>.>.###.#.###",
             "###v#####.#v#.###.#.###",
             "###.>...#.#.#.....#...#",
             "###v###.#.#.#########.#",
             "###...#.#.#.......#...#",
             "#####.#.#.#######.#.###",
             "#.....#.#.#.......#...#",
             "#.#####.#.#.#########v#",
             "#.#...#...#...###...>.#",
             "#.#.#v#######v###.###v#",
             "#...#.>.#...>.>.#.###.#",
             "#####v#.#.###v#.#.###.#",
             "#.....#...#...#.#.#...#",
             "#.#########.###.#.#.###",
             "#...###...#...#...#.###",
             "###.###.#.###v#####v###",
             "#...#...#.#.>.>.#.>.###",
             "#.###.###.#.###.#.#v###",
             "#.....###...###...#...#",
             "#####################.#"]
    # When
    result = parse_trail(lines)
    # Then
    assert result == ["#########################",
                      "##.######################",
                      "##.......#########...####",
                      "########.#########.#.####",
                      "####.....#.>.>.###.#.####",
                      "####v#####.#v#.###.#.####",
                      "####.>...#.#.#.....#...##",
                      "####v###.#.#.#########.##",
                      "####...#.#.#.......#...##",
                      "######.#.#.#######.#.####",
                      "##.....#.#.#.......#...##",
                      "##.#####.#.#.#########v##",
                      "##.#...#...#...###...>.##",
                      "##.#.#v#######v###.###v##",
                      "##...#.>.#...>.>.#.###.##",
                      "######v#.#.###v#.#.###.##",
                      "##.....#...#...#.#.#...##",
                      "##.#########.###.#.#.####",
                      "##...###...#...#...#.####",
                      "####.###.#.###v#####v####",
                      "##...#...#.#.>.>.#.>.####",
                      "##.###.###.#.###.#.#v####",
                      "##.....###...###...#...##",
                      "######################.##",
                      "#########################"]


def test_get_possible_steps():
    # Given
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    current_position = (1, 2)
    # When
    result = get_possible_steps(trail, current_position, set())
    # Then
    assert result == {(2, 2)}


def test_get_possible_steps_already_visited_cells():
    # Given
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    current_position = (2, 2)
    already_visited_cells = {(1, 2)}
    # When
    result = get_possible_steps(trail, current_position, already_visited_cells)
    # Then
    assert result == {(2, 3)}


def test_get_possible_steps_downhill():
    # Given
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    current_position = (4, 11)
    # When
    result = get_possible_steps(trail, current_position, set())
    # Then
    assert result == {(4, 12)}


def test_navigate_trail():
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    current_position = (1, 2)
    already_visited_cells = frozenset()
    # When
    result = navigate_trail(trail, current_position, already_visited_cells)
    # Then
    assert result == {((2, 2), frozenset({(1, 2)}))}


def test_get_all_paths():
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    starting_position = (1, 2)
    target_position = (23, 22)
    # When
    result = get_all_paths(trail, starting_position, target_position)
    # Then
    assert sorted([len(path) for path in result], reverse=True) == [94, 90, 86, 82, 82, 74]


def test_get_target_position():
    # Given
    trail = ["#########################",
             "##.######################",
             "##.......#########...####",
             "########.#########.#.####",
             "####.....#.>.>.###.#.####",
             "####v#####.#v#.###.#.####",
             "####.>...#.#.#.....#...##",
             "####v###.#.#.#########.##",
             "####...#.#.#.......#...##",
             "######.#.#.#######.#.####",
             "##.....#.#.#.......#...##",
             "##.#####.#.#.#########v##",
             "##.#...#...#...###...>.##",
             "##.#.#v#######v###.###v##",
             "##...#.>.#...>.>.#.###.##",
             "######v#.#.###v#.#.###.##",
             "##.....#...#...#.#.#...##",
             "##.#########.###.#.#.####",
             "##...###...#...#...#.####",
             "####.###.#.###v#####v####",
             "##...#...#.#.>.>.#.>.####",
             "##.###.###.#.###.#.#v####",
             "##.....###...###...#...##",
             "######################.##",
             "#########################"]
    # When
    result = get_target_position(trail)
    # Then
    assert result == (23, 22)
